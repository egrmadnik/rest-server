<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REST Server API Documentation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
        }
        .endpoint {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .endpoint h3 {
            margin-top: 0;
            color: #2980b9;
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .method {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-weight: bold;
            margin-right: 10px;
        }
        .get { background: #27ae60; color: white; }
        .post { background: #2980b9; color: white; }
        .put { background: #f39c12; color: white; }
        .delete { background: #c0392b; color: white; }
        .home-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            transition: background 0.3s;
        }
        .home-button:hover {
            background: #2980b9;
        }
        .response-example {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <a href="/" class="home-button">‚Üê Back to Home</a>
    <h1>REST Server API Documentation</h1>
    
    <p>This server provides REST endpoints for managing users, devices, locations, and consumption data. All endpoints return JSON responses with pagination support and schema validation.</p>
    
    <h2>Base URL</h2>
    <pre>http://localhost:3000</pre>

    <h2>Schema Management</h2>
    <div class="endpoint">
        <h3>Schema Endpoints</h3>
        <ul>
            <li><strong>GET /schemas</strong> - List all available schemas</li>
            <li><strong>GET /schemas/{resource_name}</strong> - Get schema for specific resource</li>
            <li><strong>PUT /schemas/{resource_name}</strong> - Update schema for specific resource</li>
        </ul>
        
        <h3>Example Requests</h3>
        <pre>
# List all schemas
curl http://localhost:3000/schemas

# Get users schema
curl http://localhost:3000/schemas/users

# Update users schema
curl -X PUT http://localhost:3000/schemas/users \
  -H "Content-Type: application/json" \
  -d '{
    "type": "object",
    "properties": {
      "name": {"type": "string", "minLength": 1},
      "email": {"type": "string", "format": "email"}
    },
    "required": ["name", "email"]
  }'</pre>

        <div class="note">
            <strong>Note:</strong> When updating a schema, ensure it's a valid JSON Schema. The new schema will be used for validating all subsequent requests for that resource.
        </div>
    </div>

    <h2>Pagination</h2>
    <div class="endpoint">
        <h3>Query Parameters</h3>
        <ul>
            <li><strong>page</strong>: Page number (default: 1)</li>
            <li><strong>per_page</strong>: Items per page (default: 10, max: 100)</li>
        </ul>
        <h3>Example Request</h3>
        <pre>
# Get page 2 with 5 items per page
curl http://localhost:3000/users?page=2&per_page=5</pre>
        
        <h3>Response Format</h3>
        <p>All list endpoints return paginated responses with the following structure:</p>
        <div class="response-example">
<pre>{
  "data": [
    // Array of items for current page
  ],
  "metadata": {
    "total_items": 50,      // Total number of items
    "total_pages": 5,       // Total number of pages
    "current_page": 2,      // Current page number
    "per_page": 10,         // Items per page
    "first_page": "http://localhost:3000/users?page=1&per_page=10",
    "last_page": "http://localhost:3000/users?page=5&per_page=10",
    "next_page": "http://localhost:3000/users?page=3&per_page=10",
    "prev_page": "http://localhost:3000/users?page=1&per_page=10"
  }
}</pre>
        </div>
        <div class="note">
            <strong>Note:</strong> The metadata includes navigation URLs for first, last, next, and previous pages. 
            URLs will be null if the page doesn't exist (e.g., prev_page is null on the first page).
        </div>
    </div>

    <h2>Available Resources</h2>
    <ul>
        <li>Users (/users)</li>
        <li>Devices (/devices)</li>
        <li>Locations (/locations)</li>
        <li>Consumption (/consumption)</li>
    </ul>

    <h2>Example Requests</h2>
    
    <div class="endpoint">
        <h3><span class="method get">GET</span> List All Resources</h3>
        <p>Retrieve all items for a resource with pagination support.</p>
        <pre>
# Get all users (first page, default 10 items)
curl http://localhost:3000/users

# Get second page of devices with 5 items per page
curl http://localhost:3000/devices?page=2&per_page=5

# Get all locations with maximum items per page
curl http://localhost:3000/locations?per_page=100</pre>
    </div>

    <div class="endpoint">
        <h3><span class="method get">GET</span> Get Single Item</h3>
        <p>Retrieve a specific item by ID.</p>
        <pre>
# Get user with ID 1
curl http://localhost:3000/users/1

# Get device with ID 2
curl http://localhost:3000/devices/2</pre>
    </div>

    <div class="endpoint">
        <h3><span class="method post">POST</span> Create New Item</h3>
        <p>Create a new resource item. The request must conform to the resource's schema.</p>
        <pre>
# Create new user
curl -X POST http://localhost:3000/users \
  -H "Content-Type: application/json" \
  -d '{"name": "John Doe", "email": "john@example.com"}'

# Create new device
curl -X POST http://localhost:3000/devices \
  -H "Content-Type: application/json" \
  -d '{"name": "Smart Thermostat", "type": "temperature", "location_id": 1}'

# Create new location
curl -X POST http://localhost:3000/locations \
  -H "Content-Type: application/json" \
  -d '{"name": "Living Room", "address": "123 Main St"}'

# Create new consumption record
curl -X POST http://localhost:3000/consumption \
  -H "Content-Type: application/json" \
  -d '{"name": "Daily Usage", "type": "electricity", "location_id": 1}'</pre>
    </div>

    <div class="endpoint">
        <h3><span class="method put">PUT</span> Update Item</h3>
        <p>Update an existing item by ID. The request must conform to the resource's schema.</p>
        <pre>
# Update user with ID 1
curl -X PUT http://localhost:3000/users/1 \
  -H "Content-Type: application/json" \
  -d '{"name": "John Smith", "email": "john.smith@example.com"}'

# Update device with ID 2
curl -X PUT http://localhost:3000/devices/2 \
  -H "Content-Type: application/json" \
  -d '{"name": "Smart Thermostat v2", "type": "temperature", "location_id": 1}'</pre>
    </div>

    <div class="endpoint">
        <h3><span class="method delete">DELETE</span> Delete Item</h3>
        <p>Delete an item by ID.</p>
        <pre>
# Delete user with ID 1
curl -X DELETE http://localhost:3000/users/1

# Delete device with ID 2
curl -X DELETE http://localhost:3000/devices/2</pre>
    </div>

    <h2>Response Codes</h2>
    <ul>
        <li><strong>200 OK</strong> - Request successful</li>
        <li><strong>201 Created</strong> - Resource created successfully</li>
        <li><strong>400 Bad Request</strong> - Invalid request (e.g., missing required fields or schema validation failed)</li>
        <li><strong>404 Not Found</strong> - Resource or schema not found</li>
    </ul>

</body>
</html>
